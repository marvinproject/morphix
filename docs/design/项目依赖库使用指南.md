# Agent Forge é¡¹ç›®ä¾èµ–åº“ä½¿ç”¨æŒ‡å—

æœ¬æ–‡æ¡£ä¸º Agent Forge é¡¹ç›®æ–°æ‰‹å¼€å‘è€…ä»‹ç»é¡¹ç›®ä¸­ä½¿ç”¨çš„å„ä¸ªä¾èµ–åº“ï¼Œè¯´æ˜æ¯ä¸ªåº“çš„ç”¨é€”ã€æ ¸å¿ƒåŠŸèƒ½å’ŒåŸºæœ¬ä½¿ç”¨æ–¹æ³•ã€‚

## ğŸ“‹ ç›®å½•

1. [Web æ¡†æ¶æ ¸å¿ƒ](#web-æ¡†æ¶æ ¸å¿ƒ)
2. [æ•°æ®åº“ç›¸å…³](#æ•°æ®åº“ç›¸å…³)
3. [è®¤è¯ä¸å®‰å…¨](#è®¤è¯ä¸å®‰å…¨)
4. [å¼‚æ­¥ä»»åŠ¡å¤„ç†](#å¼‚æ­¥ä»»åŠ¡å¤„ç†)
5. [HTTP å®¢æˆ·ç«¯](#http-å®¢æˆ·ç«¯)
6. [æ—¥å¿—ä¸ç›‘æ§](#æ—¥å¿—ä¸ç›‘æ§)
7. [å…¶ä»–å·¥å…·åº“](#å…¶ä»–å·¥å…·åº“)

## Web æ¡†æ¶æ ¸å¿ƒ

### FastAPI
**ç”¨é€”**: ç°ä»£ã€å¿«é€Ÿçš„ Web API æ¡†æ¶

FastAPI æ˜¯é¡¹ç›®çš„æ ¸å¿ƒæ¡†æ¶ï¼Œæä¾›äº†ï¼š
- è‡ªåŠ¨ API æ–‡æ¡£ç”Ÿæˆï¼ˆSwagger UIï¼‰
- åŸºäº Python ç±»å‹æç¤ºçš„è¯·æ±‚éªŒè¯
- å¼‚æ­¥è¯·æ±‚å¤„ç†æ”¯æŒ
- é«˜æ€§èƒ½ï¼ˆåŸºäº Starlette å’Œ Pydanticï¼‰

**åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹**ï¼š
```python
from fastapi import FastAPI

app = FastAPI(title="Agent Forge API")

@app.get("/agents")
async def list_agents():
    return {"agents": ["agent1", "agent2"]}
```

### Uvicorn[standard]
**ç”¨é€”**: ASGI æœåŠ¡å™¨ï¼Œç”¨äºè¿è¡Œ FastAPI åº”ç”¨

Uvicorn æ˜¯ä¸€ä¸ªè½»é‡çº§ã€è¶…å¿«çš„ ASGI æœåŠ¡å™¨å®ç°ï¼š
- æ”¯æŒ HTTP/1.1 å’Œ WebSocket
- å†…ç½®è‡ªåŠ¨é‡è½½åŠŸèƒ½ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
- ç”Ÿäº§çº§æ€§èƒ½

**å¯åŠ¨å‘½ä»¤**ï¼š
```bash
# å¼€å‘ç¯å¢ƒï¼ˆè‡ªåŠ¨é‡è½½ï¼‰
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# ç”Ÿäº§ç¯å¢ƒ
uvicorn app.main:app --workers 4 --host 0.0.0.0 --port 8000
```

### Pydantic
**ç”¨é€”**: æ•°æ®éªŒè¯å’Œè®¾ç½®ç®¡ç†

Pydantic åœ¨é¡¹ç›®ä¸­ç”¨äºï¼š
- å®šä¹‰ API è¯·æ±‚/å“åº”æ¨¡å‹
- è‡ªåŠ¨æ•°æ®éªŒè¯
- ç±»å‹è½¬æ¢
- JSON Schema ç”Ÿæˆ

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```python
from pydantic import BaseModel, Field

class AgentCreate(BaseModel):
    name: str = Field(..., min_length=1, max_length=100)
    description: str | None = None
    config: dict = Field(default_factory=dict)
```

### Pydantic-settings
**ç”¨é€”**: åº”ç”¨é…ç½®ç®¡ç†

ç”¨äºä»ç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ç­‰åŠ è½½åº”ç”¨è®¾ç½®ï¼š
```python
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    database_url: str
    redis_url: str
    secret_key: str
    
    class Config:
        env_file = ".env"
```

## æ•°æ®åº“ç›¸å…³

### SQLAlchemy
**ç”¨é€”**: Python SQL å·¥å…·åŒ…å’Œ ORM

SQLAlchemy 2.0+ æä¾›ï¼š
- å¼ºå¤§çš„ ORM åŠŸèƒ½
- å¼‚æ­¥æ•°æ®åº“æ“ä½œæ”¯æŒ
- çµæ´»çš„æŸ¥è¯¢æ„å»ºå™¨
- æ•°æ®åº“è¿ç§»æ”¯æŒï¼ˆé…åˆ Alembicï¼‰

**æ¨¡å‹å®šä¹‰ç¤ºä¾‹**ï¼š
```python
from sqlalchemy.orm import DeclarativeBase, Mapped, mapped_column

class Base(DeclarativeBase):
    pass

class Agent(Base):
    __tablename__ = "agents"
    
    id: Mapped[int] = mapped_column(primary_key=True)
    name: Mapped[str] = mapped_column(String(100))
    created_at: Mapped[datetime] = mapped_column(default=func.now())
```

### AsyncPG
**ç”¨é€”**: PostgreSQL çš„é«˜æ€§èƒ½å¼‚æ­¥é©±åŠ¨

AsyncPG ç‰¹ç‚¹ï¼š
- ä¸“ä¸º PostgreSQL è®¾è®¡çš„å¼‚æ­¥é©±åŠ¨
- æ¯” psycopg2 å¿« 3-4 å€
- æ”¯æŒè¿æ¥æ± 
- ä¸ SQLAlchemy å¼‚æ­¥æ¨¡å¼å®Œç¾é…åˆ

### Psycopg2-binary
**ç”¨é€”**: PostgreSQL åŒæ­¥é©±åŠ¨ï¼ˆå¤‡ç”¨ï¼‰

è™½ç„¶ä¸»è¦ä½¿ç”¨ asyncpgï¼Œä½†æŸäº›å·¥å…·ï¼ˆå¦‚ Alembicï¼‰å¯èƒ½éœ€è¦åŒæ­¥é©±åŠ¨ã€‚

### PGVector
**ç”¨é€”**: PostgreSQL å‘é‡æ•°æ®åº“æ‰©å±•çš„ Python å®¢æˆ·ç«¯

ç”¨äºå®ç°å‘é‡æœç´¢åŠŸèƒ½ï¼š
- å­˜å‚¨å’ŒæŸ¥è¯¢å‘é‡åµŒå…¥
- æ”¯æŒç›¸ä¼¼åº¦æœç´¢
- ç”¨äºæ„å»º RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ç³»ç»Ÿ

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```python
from pgvector.sqlalchemy import Vector

class Document(Base):
    __tablename__ = "documents"
    
    id: Mapped[int] = mapped_column(primary_key=True)
    content: Mapped[str]
    embedding: Mapped[list[float]] = mapped_column(Vector(1536))
```

### Alembic
**ç”¨é€”**: æ•°æ®åº“è¿ç§»å·¥å…·

Alembic ç®¡ç†æ•°æ®åº“æ¶æ„å˜æ›´ï¼š
- è‡ªåŠ¨ç”Ÿæˆè¿ç§»è„šæœ¬
- ç‰ˆæœ¬æ§åˆ¶æ•°æ®åº“æ¶æ„
- æ”¯æŒå‡çº§å’Œå›æ»š

**å¸¸ç”¨å‘½ä»¤**ï¼š
```bash
# åˆå§‹åŒ– Alembic
alembic init alembic

# åˆ›å»ºè¿ç§»
alembic revision --autogenerate -m "Add agent table"

# æ‰§è¡Œè¿ç§»
alembic upgrade head
```

## è®¤è¯ä¸å®‰å…¨

### Python-jose[cryptography]
**ç”¨é€”**: JWT (JSON Web Token) å¤„ç†

ç”¨äºï¼š
- ç”Ÿæˆå’ŒéªŒè¯ JWT token
- å®ç°æ— çŠ¶æ€è®¤è¯
- åŠ å¯†æ•æ„Ÿä¿¡æ¯

**ç¤ºä¾‹**ï¼š
```python
from jose import jwt

def create_access_token(data: dict):
    to_encode = data.copy()
    expire = datetime.utcnow() + timedelta(minutes=15)
    to_encode.update({"exp": expire})
    return jwt.encode(to_encode, SECRET_KEY, algorithm="HS256")
```

### Passlib[bcrypt]
**ç”¨é€”**: å¯†ç å“ˆå¸Œå’ŒéªŒè¯

æä¾›å®‰å…¨çš„å¯†ç å¤„ç†ï¼š
- Bcrypt å“ˆå¸Œç®—æ³•
- å¯†ç å¼ºåº¦éªŒè¯
- è‡ªåŠ¨å¤„ç†ç›å€¼

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```python
from passlib.context import CryptContext

pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")

# å“ˆå¸Œå¯†ç 
hashed_password = pwd_context.hash(plain_password)

# éªŒè¯å¯†ç 
is_valid = pwd_context.verify(plain_password, hashed_password)
```

### Python-multipart
**ç”¨é€”**: å¤„ç† multipart/form-data è¯·æ±‚

æ”¯æŒï¼š
- æ–‡ä»¶ä¸Šä¼ 
- è¡¨å•æ•°æ®è§£æ
- ä¸ FastAPI é›†æˆå¤„ç†æ–‡ä»¶ä¸Šä¼ 

## å¼‚æ­¥ä»»åŠ¡å¤„ç†

### Celery
**ç”¨é€”**: åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—

Celery ç”¨äºå¤„ç†ï¼š
- é•¿æ—¶é—´è¿è¡Œçš„ä»»åŠ¡
- å®šæ—¶ä»»åŠ¡
- å¼‚æ­¥å·¥ä½œæµæ‰§è¡Œ
- ä»»åŠ¡é‡è¯•å’Œé”™è¯¯å¤„ç†

**åŸºæœ¬é…ç½®**ï¼š
```python
from celery import Celery

celery_app = Celery(
    "agent_forge",
    broker="redis://localhost:6379/0",
    backend="redis://localhost:6379/1"
)

@celery_app.task
def process_workflow(workflow_id: str):
    # å¤„ç†å·¥ä½œæµ
    pass
```

### Redis
**ç”¨é€”**: å†…å­˜æ•°æ®å­˜å‚¨ï¼Œç”¨ä½œç¼“å­˜å’Œæ¶ˆæ¯é˜Ÿåˆ—

Redis åœ¨é¡¹ç›®ä¸­çš„ç”¨é€”ï¼š
- Celery çš„æ¶ˆæ¯ä»£ç†
- åº”ç”¨ç¼“å­˜
- ä¼šè¯å­˜å‚¨
- å®æ—¶æ•°æ®å­˜å‚¨

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```python
import redis.asyncio as redis

async def get_redis():
    return await redis.from_url("redis://localhost:6379")

# ç¼“å­˜ä½¿ç”¨
async def get_agent(agent_id: str):
    r = await get_redis()
    cached = await r.get(f"agent:{agent_id}")
    if cached:
        return json.loads(cached)
```

## HTTP å®¢æˆ·ç«¯

### HTTPX
**ç”¨é€”**: ç°ä»£çš„å¼‚æ­¥ HTTP å®¢æˆ·ç«¯

HTTPX ç‰¹ç‚¹ï¼š
- åŒæ—¶æ”¯æŒåŒæ­¥å’Œå¼‚æ­¥
- HTTP/1.1 å’Œ HTTP/2 æ”¯æŒ
- è¿æ¥æ± ç®¡ç†
- è‡ªåŠ¨é‡è¯•

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```python
import httpx

async def call_external_api():
    async with httpx.AsyncClient() as client:
        response = await client.get("https://api.example.com/data")
        return response.json()
```

### Tenacity
**ç”¨é€”**: é‡è¯•åº“

ä¸ºä¸ç¨³å®šçš„æ“ä½œæ·»åŠ é‡è¯•é€»è¾‘ï¼š
- è‡ªå®šä¹‰é‡è¯•ç­–ç•¥
- æŒ‡æ•°é€€é¿
- æ¡ä»¶é‡è¯•

**ç¤ºä¾‹**ï¼š
```python
from tenacity import retry, stop_after_attempt, wait_exponential

@retry(
    stop=stop_after_attempt(3),
    wait=wait_exponential(multiplier=1, min=4, max=10)
)
async def unreliable_api_call():
    # å¯èƒ½å¤±è´¥çš„ API è°ƒç”¨
    pass
```

## æ—¥å¿—ä¸ç›‘æ§

### Structlog
**ç”¨é€”**: ç»“æ„åŒ–æ—¥å¿—

æä¾›ï¼š
- JSON æ ¼å¼æ—¥å¿—
- ä¸Šä¸‹æ–‡ä¿¡æ¯æ³¨å…¥
- æ›´å¥½çš„æ—¥å¿—æœç´¢å’Œåˆ†æ

**é…ç½®ç¤ºä¾‹**ï¼š
```python
import structlog

structlog.configure(
    processors=[
        structlog.stdlib.filter_by_level,
        structlog.stdlib.add_logger_name,
        structlog.stdlib.add_log_level,
        structlog.stdlib.PositionalArgumentsFormatter(),
        structlog.processors.TimeStamper(fmt="iso"),
        structlog.processors.StackInfoRenderer(),
        structlog.processors.format_exc_info,
        structlog.processors.UnicodeDecoder(),
        structlog.processors.JSONRenderer()
    ],
)

logger = structlog.get_logger()
logger.info("agent_created", agent_id=123, name="TestAgent")
```

### OpenTelemetry å¥—ä»¶
**ç”¨é€”**: åˆ†å¸ƒå¼è¿½è¸ªå’Œç›‘æ§

åŒ…å«ä¸‰ä¸ªåŒ…ï¼š
- `opentelemetry-api`: æ ¸å¿ƒ API
- `opentelemetry-sdk`: SDK å®ç°
- `opentelemetry-instrumentation-fastapi`: FastAPI è‡ªåŠ¨ä»ªè¡¨åŒ–

**åŸºæœ¬é…ç½®**ï¼š
```python
from opentelemetry import trace
from opentelemetry.instrumentation.fastapi import FastAPIInstrumentor

# è‡ªåŠ¨ä¸º FastAPI æ·»åŠ è¿½è¸ª
FastAPIInstrumentor.instrument_app(app)

# æ‰‹åŠ¨åˆ›å»º span
tracer = trace.get_tracer(__name__)
with tracer.start_as_current_span("process_agent"):
    # å¤„ç†é€»è¾‘
    pass
```

### Prometheus-client
**ç”¨é€”**: Prometheus ç›‘æ§æŒ‡æ ‡æ”¶é›†

ç”¨äºæš´éœ²åº”ç”¨æŒ‡æ ‡ï¼š
- è¯·æ±‚è®¡æ•°
- å“åº”æ—¶é—´
- è‡ªå®šä¹‰ä¸šåŠ¡æŒ‡æ ‡

**ç¤ºä¾‹**ï¼š
```python
from prometheus_client import Counter, Histogram, generate_latest

request_count = Counter('http_requests_total', 'Total HTTP requests')
request_duration = Histogram('http_request_duration_seconds', 'HTTP request duration')

@app.get("/metrics")
async def metrics():
    return Response(generate_latest(), media_type="text/plain")
```

## å¼€å‘ä¾èµ–åº“

### æµ‹è¯•æ¡†æ¶

#### Pytest
**ç”¨é€”**: Python æµ‹è¯•æ¡†æ¶

Pytest æ˜¯ Python æœ€æµè¡Œçš„æµ‹è¯•æ¡†æ¶ï¼š
- ç®€å•çš„æµ‹è¯•å‡½æ•°å†™æ³•
- å¼ºå¤§çš„ fixture ç³»ç»Ÿ
- ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€
- è¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Š

**åŸºæœ¬æµ‹è¯•ç¤ºä¾‹**ï¼š
```python
# test_agent.py
def test_agent_creation():
    agent = Agent(name="TestAgent")
    assert agent.name == "TestAgent"
    assert agent.id is not None
```

#### Pytest-asyncio
**ç”¨é€”**: Pytest çš„å¼‚æ­¥æµ‹è¯•æ”¯æŒ

ä¸“é—¨ç”¨äºæµ‹è¯•å¼‚æ­¥ä»£ç ï¼š
```python
import pytest

@pytest.mark.asyncio
async def test_async_agent_service():
    service = AgentService()
    agents = await service.list_agents()
    assert isinstance(agents, list)
```

#### Pytest-cov
**ç”¨é€”**: æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š

ç”Ÿæˆä»£ç è¦†ç›–ç‡æŠ¥å‘Šï¼š
```bash
# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest --cov=app --cov-report=html

# æŸ¥çœ‹è¦†ç›–ç‡æ‘˜è¦
pytest --cov=app --cov-report=term-missing
```

#### Pytest-mock
**ç”¨é€”**: Mock å¯¹è±¡æ”¯æŒ

ç®€åŒ–æµ‹è¯•ä¸­çš„ mock æ“ä½œï¼š
```python
def test_external_api_call(mocker):
    # Mock å¤–éƒ¨ API è°ƒç”¨
    mock_response = mocker.Mock()
    mock_response.json.return_value = {"status": "success"}
    mocker.patch("httpx.AsyncClient.get", return_value=mock_response)
    
    result = await call_external_api()
    assert result["status"] == "success"
```

### ä»£ç è´¨é‡å·¥å…·

#### Black
**ç”¨é€”**: Python ä»£ç æ ¼å¼åŒ–å·¥å…·

Black æ˜¯ä¸€ä¸ª"æ¯«ä¸å¦¥å"çš„ä»£ç æ ¼å¼åŒ–å·¥å…·ï¼š
- ç»Ÿä¸€çš„ä»£ç é£æ ¼
- é›¶é…ç½®
- å¿«é€Ÿæ ¼å¼åŒ–

**ä½¿ç”¨æ–¹æ³•**ï¼š
```bash
# æ ¼å¼åŒ–å•ä¸ªæ–‡ä»¶
black app/main.py

# æ ¼å¼åŒ–æ•´ä¸ªé¡¹ç›®
black .

# æ£€æŸ¥ä½†ä¸ä¿®æ”¹
black --check .
```

#### Ruff
**ç”¨é€”**: æå¿«çš„ Python linter

Ruff ç‰¹ç‚¹ï¼š
- æ¯”ä¼ ç»Ÿ linter å¿« 10-100 å€
- æ”¯æŒå¤šç§ linting è§„åˆ™
- å¯ä»¥æ›¿ä»£ flake8, pylint, isort ç­‰

**é…ç½®ç¤ºä¾‹** (pyproject.toml):
```toml
[tool.ruff]
select = ["E", "F", "I", "N", "UP", "S", "B", "A", "C4", "RET", "SIM"]
ignore = ["E501"]  # å¿½ç•¥è¡Œé•¿åº¦é™åˆ¶
target-version = "py311"

[tool.ruff.per-file-ignores]
"tests/*" = ["S101"]  # æµ‹è¯•æ–‡ä»¶ä¸­å…è®¸ä½¿ç”¨ assert
```

#### Mypy
**ç”¨é€”**: Python é™æ€ç±»å‹æ£€æŸ¥å™¨

Mypy éªŒè¯ç±»å‹æ³¨è§£çš„æ­£ç¡®æ€§ï¼š
- æ•è·ç±»å‹ç›¸å…³é”™è¯¯
- æé«˜ä»£ç å¯ç»´æŠ¤æ€§
- æ›´å¥½çš„ IDE æ”¯æŒ

**é…ç½®ç¤ºä¾‹** (pyproject.toml):
```toml
[tool.mypy]
python_version = "3.11"
warn_return_any = true
warn_unused_configs = true
disallow_untyped_defs = true
```

### å¼€å‘æµç¨‹å·¥å…·

#### Pre-commit
**ç”¨é€”**: Git é’©å­ç®¡ç†æ¡†æ¶

åœ¨æäº¤ä»£ç å‰è‡ªåŠ¨è¿è¡Œæ£€æŸ¥ï¼š
- ä»£ç æ ¼å¼åŒ–
- Linting
- ç±»å‹æ£€æŸ¥
- é˜²æ­¢æäº¤å¤§æ–‡ä»¶

**é…ç½®æ–‡ä»¶** (.pre-commit-config.yaml):
```yaml
repos:
  - repo: https://github.com/psf/black
    rev: 23.12.0
    hooks:
      - id: black
        
  - repo: https://github.com/charliermarsh/ruff-pre-commit
    rev: v0.1.9
    hooks:
      - id: ruff
        
  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.8.0
    hooks:
      - id: mypy
        additional_dependencies: [types-all]
```

**å®‰è£…å’Œä½¿ç”¨**ï¼š
```bash
# å®‰è£… git hooks
pre-commit install

# æ‰‹åŠ¨è¿è¡Œæ‰€æœ‰ hooks
pre-commit run --all-files
```

### æµ‹è¯•æ•°æ®ç”Ÿæˆ

#### Faker
**ç”¨é€”**: ç”Ÿæˆå‡æ•°æ®

ç”¨äºæµ‹è¯•å’Œå¼€å‘ç¯å¢ƒçš„æ•°æ®ç”Ÿæˆï¼š
```python
from faker import Faker

fake = Faker()

# ç”Ÿæˆæµ‹è¯•æ•°æ®
test_user = {
    "name": fake.name(),
    "email": fake.email(),
    "address": fake.address(),
    "phone": fake.phone_number()
}
```

#### Factory Boy
**ç”¨é€”**: æµ‹è¯•å›ºä»¶å·¥å‚

ä¸ ORM é›†æˆï¼Œæ–¹ä¾¿åˆ›å»ºæµ‹è¯•å¯¹è±¡ï¼š
```python
import factory
from factory.alchemy import SQLAlchemyModelFactory

class AgentFactory(SQLAlchemyModelFactory):
    class Meta:
        model = Agent
        sqlalchemy_session = session
    
    name = factory.Faker("company")
    description = factory.Faker("text")
    is_active = True
    
# ä½¿ç”¨å·¥å‚åˆ›å»ºæµ‹è¯•æ•°æ®
def test_agent_workflow():
    agent = AgentFactory()
    workflow = WorkflowFactory(agent=agent)
    assert workflow.agent.name == agent.name
```

### ç±»å‹å­˜æ ¹

#### Types-redis
**ç”¨é€”**: Redis åº“çš„ç±»å‹æç¤º

ä¸º redis-py æä¾›ç±»å‹ä¿¡æ¯ï¼Œæ”¹å–„ IDE æ”¯æŒå’Œç±»å‹æ£€æŸ¥ã€‚

#### Types-passlib
**ç”¨é€”**: Passlib åº“çš„ç±»å‹æç¤º

ä¸º passlib æä¾›ç±»å‹ä¿¡æ¯ï¼Œç¡®ä¿ç±»å‹æ£€æŸ¥çš„å‡†ç¡®æ€§ã€‚

## å®‰è£…ä¾èµ–

### å®‰è£…ç”Ÿäº§ä¾èµ–

ä½¿ç”¨ uv åŒ…ç®¡ç†å™¨ä¸€æ¬¡æ€§å®‰è£…æ‰€æœ‰ç”Ÿäº§ä¾èµ–ï¼š

```bash
uv add fastapi "uvicorn[standard]" sqlalchemy asyncpg alembic redis pydantic celery "pydantic-settings" "python-jose[cryptography]" "passlib[bcrypt]" "python-multipart" httpx tenacity structlog "opentelemetry-api" "opentelemetry-sdk" "opentelemetry-instrumentation-fastapi" "prometheus-client" "psycopg2-binary" pgvector
```

### å®‰è£…å¼€å‘ä¾èµ–

å®‰è£…æ‰€æœ‰å¼€å‘å’Œæµ‹è¯•ç›¸å…³çš„ä¾èµ–ï¼š

```bash
uv add --dev pytest "pytest-asyncio" pytest-cov pytest-mock black ruff mypy pre-commit faker factory-boy httpx types-redis types-passlib
```

## å¼€å‘å·¥ä½œæµå»ºè®®

### 1. åˆå§‹åŒ–å¼€å‘ç¯å¢ƒ

```bash
# å®‰è£…æ‰€æœ‰ä¾èµ–
uv add ... # ç”Ÿäº§ä¾èµ–
uv add --dev ... # å¼€å‘ä¾èµ–

# è®¾ç½® pre-commit
pre-commit install
pre-commit run --all-files  # é¦–æ¬¡è¿è¡Œï¼Œç¡®ä¿ä»£ç ç¬¦åˆè§„èŒƒ
```

### 2. æ—¥å¸¸å¼€å‘æµç¨‹

```bash
# 1. ç¼–å†™ä»£ç 
# 2. æœ¬åœ°æµ‹è¯•
pytest tests/test_module.py

# 3. æ ¼å¼åŒ–å’Œæ£€æŸ¥
black .
ruff check . --fix
mypy app/

# 4. è¿è¡Œå®Œæ•´æµ‹è¯•
pytest --cov=app

# 5. æäº¤ä»£ç ï¼ˆpre-commit ä¼šè‡ªåŠ¨è¿è¡Œæ£€æŸ¥ï¼‰
git commit -m "feat: add new feature"
```

### 3. æµ‹è¯•ç­–ç•¥

- **å•å…ƒæµ‹è¯•**: ä½¿ç”¨ pytest + pytest-mock
- **é›†æˆæµ‹è¯•**: ä½¿ç”¨ pytest-asyncio + factory-boy
- **è¦†ç›–ç‡ç›®æ ‡**: 80%ä»¥ä¸Š
- **CI/CD é›†æˆ**: è‡ªåŠ¨è¿è¡Œæµ‹è¯•å’Œä»£ç è´¨é‡æ£€æŸ¥

## é¡¹ç›®ä¸­çš„å…¸å‹ä½¿ç”¨åœºæ™¯

1. **API ç«¯ç‚¹å¼€å‘**: FastAPI + Pydantic
2. **æ•°æ®æŒä¹…åŒ–**: SQLAlchemy + AsyncPG + Alembic
3. **ç”¨æˆ·è®¤è¯**: Python-jose + Passlib
4. **åå°ä»»åŠ¡**: Celery + Redis
5. **å¤–éƒ¨æœåŠ¡è°ƒç”¨**: HTTPX + Tenacity
6. **å‘é‡æœç´¢**: PGVector
7. **ç›‘æ§å’Œæ—¥å¿—**: Structlog + OpenTelemetry + Prometheus

## å­¦ä¹ å»ºè®®

1. **å…ˆæŒæ¡æ ¸å¿ƒ**: ä» FastAPIã€SQLAlchemyã€Pydantic å¼€å§‹
2. **é€æ­¥æ·±å…¥**: æ ¹æ®åŠŸèƒ½éœ€æ±‚å­¦ä¹ ç›¸åº”çš„åº“
3. **æŸ¥é˜…å®˜æ–¹æ–‡æ¡£**: æ¯ä¸ªåº“éƒ½æœ‰è¯¦ç»†çš„å®˜æ–¹æ–‡æ¡£
4. **å®è·µä¸ºä¸»**: é€šè¿‡å®é™…ç¼–ç åŠ æ·±ç†è§£

## å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆåŒæ—¶ä½¿ç”¨ asyncpg å’Œ psycopg2-binaryï¼Ÿ**
A: asyncpg ç”¨äºå¼‚æ­¥æ“ä½œï¼ˆä¸»è¦ä¸šåŠ¡é€»è¾‘ï¼‰ï¼Œpsycopg2-binary ç”¨äºåŒæ­¥å·¥å…·ï¼ˆå¦‚ Alembic è¿ç§»ï¼‰ã€‚

**Q: Redis å¯ä»¥ç”¨å…¶ä»–æ›¿ä»£å—ï¼Ÿ**
A: å¯ä»¥ï¼Œä½†éœ€è¦ç¡®ä¿ Celery æ”¯æŒä½ é€‰æ‹©çš„æ¶ˆæ¯ä»£ç†ã€‚

**Q: å¿…é¡»ä½¿ç”¨æ‰€æœ‰è¿™äº›åº“å—ï¼Ÿ**
A: ä¸æ˜¯å¿…é¡»çš„ï¼Œå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©ä½¿ç”¨ã€‚è¿™æ˜¯ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ä¼ä¸šçº§é…ç½®ã€‚

**Q: Black å’Œ Ruff æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ**
A: Black æ˜¯ä»£ç æ ¼å¼åŒ–å·¥å…·ï¼ˆå¦‚ä½•æ’ç‰ˆï¼‰ï¼ŒRuff æ˜¯ linterï¼ˆæ£€æŸ¥ä»£ç è´¨é‡é—®é¢˜ï¼‰ã€‚ä¸¤è€…äº’è¡¥ä½¿ç”¨ã€‚

**Q: ä¸ºä»€ä¹ˆéœ€è¦ types-* åŒ…ï¼Ÿ**
A: è¿™äº›æ˜¯ç±»å‹å­˜æ ¹åŒ…ï¼Œä¸ºæ²¡æœ‰å†…ç½®ç±»å‹æç¤ºçš„ç¬¬ä¸‰æ–¹åº“æä¾›ç±»å‹ä¿¡æ¯ï¼Œè®© mypy èƒ½å¤Ÿæ­£ç¡®è¿›è¡Œç±»å‹æ£€æŸ¥ã€‚

---

ğŸ’¡ **æç¤º**: å»ºè®®åˆ›å»ºä¸€ä¸ªç®€å•çš„ç¤ºä¾‹é¡¹ç›®ï¼Œé€ä¸ªå°è¯•è¿™äº›åº“çš„åŸºæœ¬åŠŸèƒ½ï¼Œè¿™æ ·èƒ½æ›´å¿«ä¸Šæ‰‹ï¼